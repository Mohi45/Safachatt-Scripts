<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Online Test</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: white;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #38bdf8;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: #1e293b;
            padding: 25px;
            border-radius: 15px;
        }

        .question {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: #0b1220;
        }

        label {
            display: block;
            margin: 6px 0;
        }

        textarea {
            width: 100%;
            height: 120px;
            border-radius: 10px;
            padding: 10px;
            background: #111827;
            color: white;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }

        #result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 12px;
            background: #0b1220;
            display: none;
        }

        .correct {
            color: #22c55e;
            font-weight: bold;
        }

        .wrong {
            color: #ef4444;
            font-weight: bold;
        }

        #timerBox {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #facc15;
        }
    </style>
</head>

<body>

    <h1>üìò Java Online Test</h1>

    <div class="container">

        <div id="timerBox">‚è≥ Time Left: <span id="timer">30:00</span></div>

        <label>Name:
            <input type="text" id="studentName" style="padding:8px;border-radius:8px;width:100%;">
        </label>

        <form id="quizForm">

            <!-- KEEP YOUR QUESTIONS SAME AS BEFORE -->
            <!-- (I shortened here for space ‚Äî keep all 20 MCQs + coding same) -->

            <!-- Advanced Questions Based on Day 1‚Äì15 Topics -->

            <div class="question">
                <h3>1. Which statement correctly describes JVM?</h3>
                <label><input type="radio" name="q1" value="A"> It converts Java source code directly to machine
                    code</label>
                <label><input type="radio" name="q1" value="B"> It executes bytecode</label>
                <label><input type="radio" name="q1" value="C"> It compiles Java code</label>
                <label><input type="radio" name="q1" value="D"> It installs JDK</label>
            </div>

            <div class="question">
                <h3>2. What happens if PATH variable is not set for JDK?</h3>
                <label><input type="radio" name="q2" value="A"> Java program will not compile from cmd</label>
                <label><input type="radio" name="q2" value="B"> JVM will stop working</label>
                <label><input type="radio" name="q2" value="C"> JRE will uninstall automatically</label>
                <label><input type="radio" name="q2" value="D"> No issue</label>
            </div>

            <div class="question">
                <h3>3. Which is the correct compilation flow?</h3>
                <label><input type="radio" name="q3" value="A"> .java ‚Üí JVM ‚Üí .class</label>
                <label><input type="radio" name="q3" value="B"> .java ‚Üí javac ‚Üí .class ‚Üí JVM</label>
                <label><input type="radio" name="q3" value="C"> .class ‚Üí javac ‚Üí JVM</label>
                <label><input type="radio" name="q3" value="D"> JVM ‚Üí javac ‚Üí .class</label>
            </div>

            <div class="question">
                <h3>4. Output of: System.out.println(5 + 3 * 2);</h3>
                <label><input type="radio" name="q4" value="A"> 16</label>
                <label><input type="radio" name="q4" value="B"> 11</label>
                <label><input type="radio" name="q4" value="C"> 13</label>
                <label><input type="radio" name="q4" value="D"> 10</label>
            </div>

            <div class="question">
                <h3>5. What is implicit type casting?</h3>
                <label><input type="radio" name="q5" value="A"> Manual conversion</label>
                <label><input type="radio" name="q5" value="B"> Automatic conversion from smaller to larger type</label>
                <label><input type="radio" name="q5" value="C"> Conversion from String to int</label>
                <label><input type="radio" name="q5" value="D"> Boolean conversion</label>
            </div>

            <div class="question">
                <h3>6. Output of: int a=10; int b=3; System.out.println(a/b);</h3>
                <label><input type="radio" name="q6" value="A"> 3.33</label>
                <label><input type="radio" name="q6" value="B"> 3</label>
                <label><input type="radio" name="q6" value="C"> 4</label>
                <label><input type="radio" name="q6" value="D"> Error</label>
            </div>

            <div class="question">
                <h3>7. What will be output? int x=5; System.out.println(++x + x++);</h3>
                <label><input type="radio" name="q7" value="A"> 11</label>
                <label><input type="radio" name="q7" value="B"> 12</label>
                <label><input type="radio" name="q7" value="C"> 13</label>
                <label><input type="radio" name="q7" value="D"> 10</label>
            </div>

            <div class="question">
                <h3>8. If nextInt() is followed by nextLine(), how to fix skipping issue?</h3>
                <label><input type="radio" name="q8" value="A"> Use next() only</label>
                <label><input type="radio" name="q8" value="B"> Add extra nextLine() after nextInt()</label>
                <label><input type="radio" name="q8" value="C"> Remove Scanner</label>
                <label><input type="radio" name="q8" value="D"> Use parseInt()</label>
            </div>

            <div class="question">
                <h3>9. Which condition is correct to check even number?</h3>
                <label><input type="radio" name="q9" value="A"> num/2==0</label>
                <label><input type="radio" name="q9" value="B"> num%2==0</label>
                <label><input type="radio" name="q9" value="C"> num%2==1</label>
                <label><input type="radio" name="q9" value="D"> num*2==0</label>
            </div>

            <div class="question">
                <h3>10. How many times will loop run? for(int i=1;i<=5;i++)< /h3>
                        <label><input type="radio" name="q10" value="A"> 4</label>
                        <label><input type="radio" name="q10" value="B"> 5</label>
                        <label><input type="radio" name="q10" value="C"> 6</label>
                        <label><input type="radio" name="q10" value="D"> Infinite</label>
            </div>

            <div class="question">
                <h3>11. Which loop is best when number of iterations unknown?</h3>
                <label><input type="radio" name="q11" value="A"> for</label>
                <label><input type="radio" name="q11" value="B"> while</label>
                <label><input type="radio" name="q11" value="C"> do-while</label>
                <label><input type="radio" name="q11" value="D"> none</label>
            </div>

            <div class="question">
                <h3>12. What is the output?
                    for(int i=1;i<=3;i++){ for(int j=1;j<=2;j++){ System.out.print("*"); } } </h3>
                        <label><input type="radio" name="q12" value="A"> **</label>
                        <label><input type="radio" name="q12" value="B"> ******</label>
                        <label><input type="radio" name="q12" value="C"> ***</label>
                        <label><input type="radio" name="q12" value="D"> Error</label>
            </div>

            <div class="question">
                <h3>13. break statement does what?</h3>
                <label><input type="radio" name="q13" value="A"> Skips iteration</label>
                <label><input type="radio" name="q13" value="B"> Stops loop completely</label>
                <label><input type="radio" name="q13" value="C"> Restarts loop</label>
                <label><input type="radio" name="q13" value="D"> Pauses loop</label>
            </div>

            <div class="question">
                <h3>14. continue statement does what?</h3>
                <label><input type="radio" name="q14" value="A"> Stops loop</label>
                <label><input type="radio" name="q14" value="B"> Skips current iteration</label>
                <label><input type="radio" name="q14" value="C"> Exits program</label>
                <label><input type="radio" name="q14" value="D"> Throws error</label>
            </div>

            <div class="question">
                <h3>15. Default value of int array elements?</h3>
                <label><input type="radio" name="q15" value="A"> null</label>
                <label><input type="radio" name="q15" value="B"> 0</label>
                <label><input type="radio" name="q15" value="C"> undefined</label>
                <label><input type="radio" name="q15" value="D"> garbage value</label>
            </div>

            <div class="question">
                <h3>16. How to declare array of 5 integers?</h3>
                <label><input type="radio" name="q16" value="A"> int arr[5];</label>
                <label><input type="radio" name="q16" value="B"> int arr = new int(5);</label>
                <label><input type="radio" name="q16" value="C"> int[] arr = new int[5];</label>
                <label><input type="radio" name="q16" value="D"> array int[5];</label>
            </div>

            <div class="question">
                <h3>17. Index of first element in array?</h3>
                <label><input type="radio" name="q17" value="A"> 1</label>
                <label><input type="radio" name="q17" value="B"> 0</label>
                <label><input type="radio" name="q17" value="C"> -1</label>
                <label><input type="radio" name="q17" value="D"> Depends</label>
            </div>

            <div class="question">
                <h3>18. What happens if array index exceeds size?</h3>
                <label><input type="radio" name="q18" value="A"> 0 returned</label>
                <label><input type="radio" name="q18" value="B"> Null returned</label>
                <label><input type="radio" name="q18" value="C"> ArrayIndexOutOfBoundsException</label>
                <label><input type="radio" name="q18" value="D"> Compile error</label>
            </div>

            <div class="question">
                <h3>19. Which loop is commonly used to traverse array?</h3>
                <label><input type="radio" name="q19" value="A"> if</label>
                <label><input type="radio" name="q19" value="B"> for</label>
                <label><input type="radio" name="q19" value="C"> switch</label>
                <label><input type="radio" name="q19" value="D"> break</label>
            </div>

            <div class="question">
                <h3>20. Length of array is accessed using:</h3>
                <label><input type="radio" name="q20" value="A"> arr.length()</label>
                <label><input type="radio" name="q20" value="B"> arr.length</label>
                <label><input type="radio" name="q20" value="C"> size(arr)</label>
                <label><input type="radio" name="q20" value="D"> arr.size()</label>
            </div>

            <h2>üíª Section B: Coding Questions (Write Answer)</h2>

            <div class="question">
                <h3>21. Coding Question 1: Write a Java program to check Prime Number.</h3>
                <textarea id="code1" placeholder="Write your Java code here..."></textarea>
            </div>

            <div class="question">
                <h3>22. Coding Question 2: Write program of sum of array.</h3>
                <textarea id="code2" placeholder="Write your Java code here..."></textarea>
            </div>

            <!-- ‚ö†Ô∏è IMPORTANT: KEEP ALL YOUR ORIGINAL QUESTIONS HERE -->
            <!-- DO NOT REMOVE ANY -->

            <button type="button" onclick="submitQuiz()">Submit Test</button>

        </form>

        <div id="result"></div>

    </div>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import {
            getFirestore, collection, addDoc, serverTimestamp,
            query, where, getDocs, orderBy
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "tests-8229d.firebaseapp.com",
            projectId: "tests-8229d",
            storageBucket: "tests-8229d.firebasestorage.app",
            messagingSenderId: "1008201324570",
            appId: "1:1008201324570:web:0f9e25ecd31b67b67699a3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const answers = {
            q1: "B",  // JVM executes bytecode
            q2: "A",  // Cannot compile from cmd without PATH
            q3: "B",  // .java ‚Üí javac ‚Üí .class ‚Üí JVM
            q4: "B",  // 5 + 3*2 = 11
            q5: "B",  // Implicit casting = smaller to larger automatic
            q6: "B",  // 10/3 = 3 (integer division)
            q7: "B",  // ++x + x++ = 6 + 6 = 12
            q8: "B",  // Extra nextLine() fixes skipping
            q9: "B",  // num % 2 == 0
            q10: "B", // Runs 5 times
            q11: "B", // while loop for unknown iterations
            q12: "B", // 3*2 = 6 stars
            q13: "B", // break stops loop
            q14: "B", // continue skips iteration
            q15: "B", // Default int array value = 0
            q16: "C", // int[] arr = new int[5];
            q17: "B", // Index starts at 0
            q18: "C", // ArrayIndexOutOfBoundsException
            q19: "B", // for loop
            q20: "B"  // arr.length
        };
        let examEnded = false;

        /* ================= TIMER ================= */

        let time = 30 * 60;
        const timerDisplay = document.getElementById("timer");

        const countdown = setInterval(() => {
            if (examEnded) return;
            let minutes = Math.floor(time / 60);
            let seconds = time % 60;
            timerDisplay.innerText = `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            time--;
            if (time < 0) {
                clearInterval(countdown);
                alert("‚è∞ Time is up! Auto Submitting...");
                submitQuiz();
            }
        }, 1000);

        /* ================= SUBMIT ================= */

        window.submitQuiz = async function () {

            if (examEnded) return;
            examEnded = true;
            clearInterval(countdown);

            let studentName = document.getElementById("studentName").value.trim();
            if (studentName === "") {
                alert("Enter Name");
                examEnded = false;
                return;
            }

            /* üö´ ONE ATTEMPT CHECK */
            const qCheck = query(collection(db, "results"),
                where("studentName", "==", studentName));
            const snapshot = await getDocs(qCheck);
            if (!snapshot.empty) {
                alert("‚ùå You already submitted this test.");
                return;
            }

            let score = 0;
            let total = 20;
            let output = "";
            let studentAnswers = {};

            for (let q in answers) {
                let selected = document.querySelector(`input[name="${q}"]:checked`);
                if (selected) {
                    studentAnswers[q] = selected.value;
                    if (selected.value === answers[q]) {
                        score++;
                        output += `<p>${q}: <span class="correct">Correct</span></p>`;
                    } else {
                        output += `<p>${q}: <span class="wrong">Wrong</span></p>`;
                    }
                } else {
                    output += `<p>${q}: <span class="wrong">Not Attempted</span></p>`;
                }
            }

            let percentage = (score / total) * 100;

            /* üèÜ RANK CALCULATION */
            const allResults = await getDocs(query(collection(db, "results"), orderBy("percentage", "desc")));
            let rank = 1;
            allResults.forEach(doc => {
                if (doc.data().percentage > percentage) rank++;
            });

            /* SAVE */
            await addDoc(collection(db, "results"), {
                studentName,
                score,
                total,
                percentage,
                rank,
                submittedAt: serverTimestamp()
            });

            let finalResult = `
<h2>üéâ Result for ${studentName}</h2>
<h3>Score: ${score}/${total}</h3>
<h3>Percentage: ${percentage.toFixed(2)}%</h3>
<h3>üèÜ Rank: ${rank}</h3>
<hr>
${output}
`;

            document.getElementById("result").innerHTML = finalResult;
            document.getElementById("result").style.display = "block";
            window.scrollTo(0, document.body.scrollHeight);

        };

    </script>

</body>

</html>